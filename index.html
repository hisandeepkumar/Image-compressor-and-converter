<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Image Converter & Compressor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f9;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        body.dark-mode .container {
            background: #1e1e1e;
        }
        input, select, button {
            margin: 10px 0;
            padding: 12px;
            width: 100%;
            border: none;
            border-radius: 10px;
            font-size: 16px;
        }
        button {
            background-color: #007BFF;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        img {
            margin-top: 20px;
            max-width: 100%;
            border-radius: 10px;
        }
        .output {
            margin-top: 20px;
        }
        .mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 22px;
            color: white;
            background-color: #333;
            cursor: pointer;
        }
        body.dark-mode .mode-toggle {
            background-color: #f39c12;
        }
    </style>
</head>
<body>
    <button class="mode-toggle" onclick="toggleDarkMode()">&#9788;</button>
    <div class="container">
        <h1>Image Converter & Compressor</h1>
        <input type="file" id="uploadImage" accept="image/*" onchange="previewImage()">
        <img id="preview" style="display:none">

        <label>Custom Width (px):</label>
        <input type="number" id="customWidth">
        <label>Custom Height (px):</label>
        <input type="number" id="customHeight">

        <label>Select Format:</label>
        <select id="format">
            <option value="jpeg">JPG</option>
            <option value="png">PNG</option>
            <option value="webp">WEBP</option>
            <option value="gif">GIF</option>
            <option value="bmp">BMP</option>
        </select>

        <label>Target Size:</label>
        <input type="number" id="targetSize" placeholder="e.g., 300">
        <select id="unit">
            <option value="KB">KB</option>
            <option value="MB">MB</option>
        </select>

        <button onclick="processImage()">Convert & Compress</button>
        <button onclick="convertToPDF()">Download as PDF</button>

        <div class="output" id="output" style="display:none">
            <h2>Processed Image:</h2>
            <img id="resultImage">
            <p><strong>Size:</strong> <span id="finalSize"></span></p>
            <a id="downloadLink" download style="display:none">Download Image</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function previewImage() {
            const file = document.getElementById('uploadImage').files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
                const preview = document.getElementById('preview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }

        function processImage() {
            const file = document.getElementById('uploadImage').files[0];
            if (!file) return alert('Please select an image');

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.src = e.target.result;

                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    const width = document.getElementById('customWidth').value || img.width;
                    const height = document.getElementById('customHeight').value || img.height;
                    canvas.width = width;
                    canvas.height = height;

                    ctx.drawImage(img, 0, 0, width, height);

                    const format = document.getElementById('format').value;
                    let quality = 1.0;
                    let dataUrl;
                    let sizeLimit = document.getElementById('targetSize').value;
                    const unit = document.getElementById('unit').value;
                    const maxKB = unit === 'MB' ? sizeLimit * 1024 : sizeLimit;

                    do {
                        dataUrl = canvas.toDataURL('image/' + format, quality);
                        const base64Length = dataUrl.length - dataUrl.indexOf(',') - 1;
                        const sizeKB = (base64Length * 3 / 4) / 1024;
                        if (sizeKB <= maxKB) break;
                        quality -= 0.05;
                    } while (quality > 0);

                    document.getElementById('resultImage').src = dataUrl;
                    document.getElementById('output').style.display = 'block';
                    document.getElementById('finalSize').textContent = ((dataUrl.length * 3 / 4) / 1024).toFixed(2) + ' KB';
                    const link = document.getElementById('downloadLink');
                    link.href = dataUrl;
                    link.style.display = 'inline';
                    link.textContent = 'Download Image';
                }
            }
            reader.readAsDataURL(file);
        }

        function convertToPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            const imgData = document.getElementById('resultImage').src;
            pdf.addImage(imgData, 'JPEG', 10, 10, 180, 160);
            pdf.save('image.pdf');
        }
    </script>
</body>
</html>
